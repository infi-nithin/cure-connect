<div class="container-fluid py-4">
  <div class="card chat-card">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="bi bi-chat-dots text-primary"></i> Chat</h5>
      <div class="d-flex align-items-center gap-2">
        <span class="badge" 
              [class.bg-success]="connectionStatus === 'connected'"
              [class.bg-warning]="connectionStatus === 'connecting'"
              [class.bg-danger]="connectionStatus === 'error'"
              [class.bg-secondary]="connectionStatus === 'disconnected'">
          {{ connectionStatus | titlecase }}
        </span>
        <button *ngIf="connectionStatus === 'error'" 
                class="btn btn-sm btn-outline-danger" 
                (click)="retry()"
                title="Retry Connection">
          <i class="bi bi-arrow-clockwise"></i>
        </button>
      </div>
    </div>
    
    <div class="card-body p-0">
      <!-- Connection Status Alerts -->
      <div class="alert alert-danger m-3 mb-0" *ngIf="connectionStatus === 'error'">
        <div class="d-flex align-items-center">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <span>Connection failed. Please check your network connection.</span>
        </div>
      </div>

      <div class="alert alert-warning m-3 mb-0" *ngIf="connectionStatus === 'connecting'">
        <div class="d-flex align-items-center">
          <i class="bi bi-hourglass-split me-2"></i>
          <span>Connecting to chat server...</span>
        </div>
      </div>

      <!-- Chat Messages -->
      <div class="chat-messages" #messagesContainer>
        <div *ngIf="messages.length === 0 && connectionStatus === 'connected'" 
             class="empty-chat-state text-center py-5">
          <i class="bi bi-chat-text display-4 text-muted"></i>
          <p class="mt-3 text-muted">No messages yet. Start the conversation!</p>
        </div>

        <div *ngFor="let message of messages" 
             class="message-item" 
             [class.message-sent]="isCurrentUser(message.sender.id)"
             [class.message-received]="!isCurrentUser(message.sender.id)">
          <div class="message-bubble">
            <div class="message-header">
              <span class="sender-name">{{ getSenderName(message) }}</span>
              <span class="message-time">{{ formatMessageTime(message.sentAt) }}</span>
            </div>
            <div class="message-content">{{ message.messageText }}</div>
            <div class="message-status">
              <span *ngIf="isCurrentUser(message.sender.id)" class="read-status">
                {{ message.isRead ? 'Read' : 'Delivered' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Message Input -->
      <div class="chat-input-container p-3 border-top">
        <div class="input-group">
          <input 
            type="text" 
            class="form-control" 
            [(ngModel)]="newMessage" 
            (keyup.enter)="sendMessage()" 
            placeholder="Type your message here..."
            [disabled]="connectionStatus !== 'connected'"
            maxlength="500">
          <button 
            class="btn btn-primary" 
            (click)="sendMessage()"
            [disabled]="connectionStatus !== 'connected' || !newMessage.trim()"
            title="Send message">
            <i class="bi bi-send"></i>
          </button>
        </div>
        <div class="message-length-hint text-end mt-1">
          <small class="text-muted">{{ newMessage.length }}/500</small>
        </div>
      </div>
    </div>
  </div>
</div>