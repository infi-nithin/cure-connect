<div class="dashboard-wrapper">
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
    <div class="container-fluid">
      <a class="navbar-brand" routerLink="/admin/dashboard">
        <i class="bi bi-hospital text-primary"></i>
        <strong>Cure Connect</strong>
      </a>
      <div class="d-flex align-items-center">
        <span class="me-3">
          <i class="bi bi-person-circle"></i>
          {{ getCurrentUserName() }} (Admin)
        </span>
        <button class="btn btn-outline-danger btn-sm" (click)="logout()">
          <i class="bi bi-box-arrow-right"></i> Logout
        </button>
      </div>
    </div>
  </nav>

  <div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <button class="btn btn-outline-secondary btn-sm me-3" (click)="goBack()">
              <i class="bi bi-arrow-left"></i>
            </button>
            <h2 class="mb-0 d-inline-block">Detailed Statistics</h2>
          </div>
          <button class="btn btn-outline-primary btn-sm" (click)="refreshStats()" [disabled]="loading">
            <i class="bi bi-arrow-clockwise" [class.spin]="loading"></i> Refresh
          </button>
        </div>
        <p class="text-muted mt-2">Comprehensive system analytics and insights</p>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-spinner text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2 text-muted">Loading detailed statistics...</p>
    </div>

    <!-- Detailed Stats Content -->
    <div *ngIf="!loading && detailedStats" class="row g-4">
      
      <!-- User Statistics -->
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-white">
            <h5 class="mb-0">
              <i class="bi bi-people text-primary me-2"></i>
              User Statistics
            </h5>
          </div>
          <div class="card-body">
            <div class="row g-4">
              <div class="col-md-4">
                <div class="stat-card">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h6 class="text-muted mb-1">Total Users</h6>
                      <h3 class="mb-0 text-primary">{{ detailedStats?.totalUsers }}</h3>
                      <small class="text-muted">All system users</small>
                    </div>
                    <div class="stat-icon-lg bg-primary">
                      <i class="bi bi-people-fill"></i>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="stat-card">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h6 class="text-muted mb-1">Doctors</h6>
                      <h3 class="mb-0 text-success">{{ detailedStats?.totalDoctors }}</h3>
                      <small class="text-muted">Medical professionals</small>
                    </div>
                    <div class="stat-icon-lg bg-success">
                      <i class="bi bi-person-badge-fill"></i>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="stat-card">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h6 class="text-muted mb-1">Patients</h6>
                      <h3 class="mb-0 text-info">{{ detailedStats?.totalPatients }}</h3>
                      <small class="text-muted">Registered patients</small>
                    </div>
                    <div class="stat-icon-lg bg-info">
                      <i class="bi bi-person-fill"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Appointment Statistics -->
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-white">
            <h5 class="mb-0">
              <i class="bi bi-calendar-check text-primary me-2"></i>
              Appointment Statistics
            </h5>
          </div>
          <div class="card-body">
            <!-- Total Appointments -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="total-appointments text-center p-4 bg-light rounded">
                  <h4 class="text-muted mb-1">Total Appointments</h4>
                  <h1 class="display-4 text-primary">{{ detailedStats?.totalAppointments }}</h1>
                  <p class="text-muted mb-0">All time appointments</p>
                </div>
              </div>
            </div>

            <!-- Appointment Breakdown -->
            <div class="row g-4">
              <div class="col-md-4">
                <div class="appointment-status-card booked">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h6 class="text-muted mb-1">Booked</h6>
                      <h3 class="mb-0">{{ detailedStats?.bookedAppointments }}</h3>
                      <small class="text-muted">
                        {{ getAppointmentPercentage('booked')}}% of total
                      </small>
                    </div>
                    <div class="status-indicator bg-primary">
                      <i class="bi bi-calendar-plus"></i>
                    </div>
                  </div>
                  <div class="progress mt-2" style="height: 6px;">
                    <div class="progress-bar bg-primary" [style.width.%]="getAppointmentPercentage('booked')"></div>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="appointment-status-card completed">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h6 class="text-muted mb-1">Completed</h6>
                      <h3 class="mb-0 text-success">{{ detailedStats?.completedAppointments }}</h3>
                      <small class="text-muted">
                        {{ getAppointmentPercentage('completed')}}% of total
                      </small>
                    </div>
                    <div class="status-indicator bg-success">
                      <i class="bi bi-check-circle"></i>
                    </div>
                  </div>
                  <div class="progress mt-2" style="height: 6px;">
                    <div class="progress-bar bg-success" [style.width.%]="getAppointmentPercentage('completed')"></div>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="appointment-status-card cancelled">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h6 class="text-muted mb-1">Cancelled</h6>
                      <h3 class="mb-0 text-danger">{{ detailedStats?.cancelledAppointments }}</h3>
                      <small class="text-muted">
                        {{ getAppointmentPercentage('cancelled') }}% of total
                      </small>
                    </div>
                    <div class="status-indicator bg-danger">
                      <i class="bi bi-x-circle"></i>
                    </div>
                  </div>
                  <div class="progress mt-2" style="height: 6px;">
                    <div class="progress-bar bg-danger" [style.width.%]="getAppointmentPercentage('cancelled')"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-white">
            <h5 class="mb-0">
              <i class="bi bi-graph-up text-primary me-2"></i>
              Performance Metrics
            </h5>
          </div>
          <div class="card-body">
            <div class="row g-4">
              <div class="col-md-6">
                <div class="metric-card">
                  <i class="bi bi-person-check text-success metric-icon"></i>
                  <div class="metric-content">
                    <h4 class="metric-value">{{ detailedStats?.totalDoctors }}</h4>
                    <p class="metric-label">Active Doctors</p>
                    <small class="text-muted">Medical professionals in system</small>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="metric-card">
                  <i class="bi bi-calendar-week text-primary metric-icon"></i>
                  <div class="metric-content">
                    <h4 class="metric-value">{{ detailedStats?.bookedAppointments }}</h4>
                    <p class="metric-label">Upcoming Appointments</p>
                    <small class="text-muted">Scheduled for future</small>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="metric-card">
                  <i class="bi bi-check-square text-success metric-icon"></i>
                  <div class="metric-content">
                    <h4 class="metric-value">{{ detailedStats?.completedAppointments }}</h4>
                    <p class="metric-label">Completed Sessions</p>
                    <small class="text-muted">Successful consultations</small>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="metric-card">
                  <i class="bi bi-activity text-info metric-icon"></i>
                  <div class="metric-content">
                    <h4 class="metric-value">{{ detailedStats?.totalUsers }}</h4>
                    <p class="metric-label">Total System Users</p>
                    <small class="text-muted">All registered users</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="!loading && !detailedStats" class="text-center py-5">
      <i class="bi bi-exclamation-triangle display-1 text-muted"></i>
      <h5 class="mt-3 text-muted">Unable to load statistics</h5>
      <p class="text-muted">Please try refreshing the page or check your connection.</p>
      <button class="btn btn-primary" (click)="refreshStats()">
        <i class="bi bi-arrow-clockwise me-1"></i> Try Again
      </button>
    </div>
  </div>
</div>